#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import syd
import click
import os
import itk

# -----------------------------------------------------------------------------
CONTEXT_SETTINGS = dict(help_option_names=['-h', '--help'])
@click.command(context_settings=CONTEXT_SETTINGS)
@click.argument('id', nargs=-1)
@click.option('--db', default='',
              help='DB filename (SYD_DB_FILENAME environment variable is used if no filename)')
def syd_geometrical_mean(id, db):
    '''
    Compute and insert geometrical mean from ant/post image
    '''

    # open the db
    db_filename = syd.get_db_filename(db)
    db = syd.open_db(db_filename)

    # find all images
    for i in id:
        image = syd.find_one(db['Image'], i)
        output = syd.insert_geometrical_mean(db, image, k=1.1)
        f = syd.get_image_filename(db, output)
        p = syd.get_image_patient(db, output)
        tags = output['tags']
        print('Inserted image {} {} {} {} {}'
              .format(output['id'], p['name'], output['modality'], f, tags))


# -----------------------------------------------------------------------------
if __name__ == '__main__':
    syd_geometrical_mean()

